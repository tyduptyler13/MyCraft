'use strict';var marchY=function(b){for(var k=[],m=null,f=0;8>f;++f){if(0!==f)for(var l=0,h=0,n=b[f].length;h<n;++h){var c=b[f][h];if(0===m.length)c.y=f,c.yLen=1,k.push(c);else for(var p=l,e=m.length;p<e;++p){var a=m[p];if(c.x<a.x&&c.z<a.z){c.y=f;c.yLen=1;k.push(c);break}else if(c.x>a.x&&c.z>a.z)l=p;else if(c.x===a.x&&c.xLen===a.xLen&&c.z===a.z&&c.zLen===a.zLen&&c.type===a.type){null!==a.y?a.yLen++:(a.y=f-1,a.yLen=2,k.push(a));b[f][h]=a;break}}}else 0===b[f+1].length&&(k=k.concat(b[f].map(function(a){a.y=
0;a.yLen=1;return a})));m=b[f]}return k},marchZ=function(b){for(var k=[],m=[],f=null,l=0;64>l;++l){var h=l%8;if(0!==h)for(var n=0,c=0,p=b[l].length;c<p;++c){var e=b[l][c];if(0===f.length)e.z=h,e.zLen=1,m.push(e);else for(var a=n,g=f.length;a<g;++a){var d=f[a];if(e.x<d.x){e.z=h;e.zLen=1;m.push(e);break}else if(e.x>d.x)n=a;else if(e.x===d.x&&e.xLen===d.xLen&&e.type===d.type){null!==d.z?d.zLen++:(d.z=h-1,d.zLen=2,m.push(d));b[l][c]=d;break}}}else 0===b[h+1].length&&(k=k.concat(b[h].map(function(a){a.z=
0;a.zLen=1;return a})));7===h?(f=null,k.push(m),m=[]):f=b[l]}return k},marchX=function(b){for(var k=[],m=[],f=null,l=0,h=0;512>h;++h){var n=h%8;b[h]!==f&&(null!==f&&m.push({type:f,x:l,y:null,z:null,xLen:n-l,yLen:null,zLen:null}),l=n,f=b[h]);7===n&&(m.push({type:f,x:l,y:null,z:null,xLen:n-l+1,yLen:null,zLen:null}),k.push(m),m=[],f=null,l=0)}k.forEach(function(c,b,e){e[b]=c.filter(function(a){return 0>a.type?!1:!0})});return k},generate=function(b){for(var k=new Float32Array(108*b.length),m=[],f=new Float32Array(108*
b.length),l=new Float32Array(72*b.length),h=[0,2,1,2,3,1,4,6,5,6,7,5,4,5,1,5,0,1,7,6,2,6,3,2,5,7,0,7,2,0,1,3,4,3,6,4],n=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]].reduce(function(a,b){return a.concat(b,b,b,b,b,b)},[]),c=0,p=b.length;c<p;++c){for(var e=b[c],a=e.xLen+e.x,g=e.yLen+e.y,d=e.zLen+e.z,q=e.x,r=e.y,t=e.z,a=[[a,g,d],[a,g,t],[a,r,d],[a,r,t],[q,g,t],[q,g,d],[q,r,t],[q,r,d]],g=0,d=h.length;g<d;++g)k[3*g+108*c]=a[h[g]][0],k[3*g+108*c+1]=a[h[g]][1],k[3*g+108*c+2]=a[h[g]][2];f.set(n,108*
c);a=e.xLen;g=e.yLen;d=e.zLen;l.set([0,g,0,0,d,g,0,0,d,0,d,g,0,g,0,0,d,g,0,0,d,0,d,g,0,d,0,0,a,d,0,0,a,0,a,d,0,d,0,0,a,d,0,0,a,0,a,d,0,g,0,0,a,g,0,0,a,0,a,g,0,g,0,0,a,g,0,0,a,0,a,g],72*c);m.push(e.type)}b={position:k.buffer,materialIndex:Uint8Array.from(m).buffer,normals:f.buffer,uvs:l.buffer};self.postMessage(b,[b.position,b.materialIndex,b.normals,b.uvs])};self.addEventListener("message",function(b){generate(marchY(marchZ(marchX(new Int8Array(b.data)))))});
