'use strict';var marchY=function(b){for(var g=[],h=null,c=0;8>c;++c){if(0!==c)for(var f=0,e=0,n=b[c].length;e<n;++e)for(var d=b[c][e],l=f,k=h.length;l<k;++l){var a=h[l];if(d.x<a.x&&d.z<a.z){d.y=c;d.yLen=1;g.push(d);break}else if(d.x>a.x&&d.z>a.z)f=l;else if(d.x===a.x&&d.xLen===a.xLen&&d.z===a.z&&d.zLen===a.zLen&&d.type===a.type){null!==a.y?a.yLen++:(a.y=c-1,a.yLen=2,g.push(a));b[c][e]=a;break}}else 0===b[c+1].length&&(g=g.concat(b[c].map(function(a){a.y=0;a.yLen=1;return a})));h=b[c]}return g},marchZ=
function(b){for(var g=[],h=[],c=null,f=0;64>f;++f){var e=f%8;if(0!==e)for(var n=0,d=0;d<b[f].length;++d)for(var l=b[f][d],k=n;k<c.length;++k){var a=c[k];if(l.x<a.x){l.z=e;l.zLen=1;h.push(l);break}else if(l.x>a.x)n=k;else if(l.x===a.x&&l.xLen===a.xLen&&l.type===a.type){null!==a.z?a.zLen++:(a.z=e-1,a.zLen=2,h.push(a));b[f][d]=a;break}}else 0===b[e+1].length&&(g=g.concat(b[e].map(function(a){a.z=0;a.zLen=1;return a})));7===e?(c=null,g.push(h),h=[]):c=b[f]}return g},marchX=function(b){for(var g=[],h=
[],c=null,f=0,e=0;512>e;++e){var n=e%8;b[e]!==c&&(null!==c&&h.push({type:c,x:f,y:null,z:null,xLen:n-f,yLen:null,zLen:null}),f=n,c=b[e]);7===n&&(h.push({type:c,x:f,y:null,z:null,xLen:n-f+1,yLen:null,zLen:null}),g.push(h),h=[],c=null,f=0)}g.forEach(function(b,c,e){e[c]=b.filter(function(a){return 0>a.type?!1:!0})});return g},generate=function(b){for(var g=new Float32Array(108*b.length),h=[],c=new Float32Array(108*b.length),f=new Float32Array(72*b.length),e=[0,2,1,2,3,1,4,6,5,6,7,5,4,5,1,5,0,1,7,6,2,
6,3,2,5,7,0,7,2,0,1,3,4,3,6,4],n=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]].reduce(function(a,b){return a.concat(b,b,b,b,b,b)},[]),d=0,l=b.length;d<l;++d){for(var k=b[d],a=k.xLen+k.x,m=k.yLen+k.y,p=k.zLen+k.z,q=k.x,r=k.y,t=k.z,a=[[a,m,p],[a,m,t],[a,r,p],[a,r,t],[q,m,t],[q,m,p],[q,r,t],[q,r,p]],m=0,p=e.length;m<p;++m)g[3*m+108*d]=a[e[m]][0],g[3*m+108*d+1]=a[e[m]][1],g[3*m+108*d+2]=a[e[m]][2];c.set(n,108*d);f.set([0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,
0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1],72*d);h.push(k.type)}console.log(g,h,c,f);b={position:g.buffer,materialIndex:Uint8Array.from(h).buffer,normals:c.buffer,uvs:f.buffer};self.postMessage(b,[b.position,b.materialIndex,b.normals,b.uvs])};self.addEventListener("message",function(b){generate(marchY(marchZ(marchX(new Int8Array(b.data)))))});
