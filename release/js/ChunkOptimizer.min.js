var marchY=function(b){for(var k=[],g=null,d=0;8>d;++d){if(0!==d)for(var e=0,f=0;f<b[d].length;++f)for(var c=b[d][f],l=e;l<g.length;++l){var a=g[l];if(c.x<a.x&&c.z<a.z){c.y=d;c.yLen=1;k.push(c);break}else c.x>a.x&&c.z>a.z?e=l:c.x===a.x&&c.xLen===a.xLen&&c.z===a.z&&c.zLen===a.zLen&&(null!==a.y?a.yLen++:(a.y=d-1,a.yLen=2,k.push(a)),b[d][f]=a)}g=b[d]}return k},marchZ=function(b){for(var k=[],g=[],d=null,e=0;64>e;++e){var f=e%8;if(0!==f)for(var c=0,l=0;l<b[e].length;++l)for(var a=b[e][l],m=c;m<d.length;++m){var h=
d[m];if(a.x<h.x){a.z=f;a.zLen=1;g.push(a);break}else a.x>h.x?c=m:a.x===h.x&&a.xLen===h.xLen&&(null!==h.z?h.zLen++:(h.z=f-1,h.zLen=2,g.push(h)),b[e][l]=h)}7===f?(d=null,k.push(g),g=[]):d=b[e]}return k},marchX=function(b){for(var k=[],g=[],d=null,e=0,f=0;512>f;++f){var c=f%8;b[f]!==d&&(0!==c&&g.push({type:d,x:e,y:null,z:null,xLen:c-e,yLen:null,zLen:null}),e=c,d=b[f]);7===c&&(g.push({type:d,x:e,y:null,z:null,xLen:c-e+1,yLen:null,zLen:null}),k.push(g),g=[],d=null,e=0)}return k},generate=function(b){var k=
[],g=[],d=[],e=[],f=[];b.forEach(function(c){var b=c.xLen+c.x,a=c.yLen+c.y,m=c.zLen+c.z,h=c.x,n=c.y,p=c.z,q=k.length;k.push(b,a,m,b,a,p,b,n,m,b,n,p,h,a,p,h,a,m,h,n,p,h,n,m);d=d.concat([0,2,1,2,3,1,4,6,5,6,7,5,4,5,1,5,0,1,7,6,2,6,3,2,5,7,0,7,2,0,1,3,4,3,6,4].map(function(a){return a+q}));e=e.concat([[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]].reduce(function(a,c){for(var b=0;6>b;++b)a=a.concat(c);return a},[]));b=1*c.zLen;a=[];a.push(0,1*c.xLen,0,0,b,b,0,0,1*c.yLen,0,b,b);f=f.concat(a,a,a,
a,a,a);g.push(c.type)});b={position:Float32Array.from(k).buffer,materialIndex:Uint8Array.from(g).buffer,indices:Uint16Array.from(d).buffer,normals:Float32Array.from(e).buffer,uvs:Float32Array.from(f).buffer};self.postMessage(b,[b.position,b.materialIndex,b.indices,b.normals,b.uvs])};self.addEventListener("message",function(b){generate(marchY(marchZ(marchX(new Int8Array(b.data)))))});
